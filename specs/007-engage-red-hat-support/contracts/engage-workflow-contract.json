{
  "workflow": "engage_red_hat_support",
  "mode": "three_step_multi_resource_ui_orchestration",
  "description": "Linux-only support engagement workflow orchestrated by UI/skill using existing tools and secure PAT intake endpoint.",
  "preconditions": {
    "product": {
      "allowedValues": ["linux"],
      "rejectMessage": "Only Linux is supported in this workflow."
    },
    "jiraConnection": {
      "creationEndpoint": "POST /api/jira/connections",
      "verificationEndpoint": "GET /api/jira/connections/{connection_id}",
      "mustBeVerifiedBeforeDiagnostics": true
    }
  },
  "compatibilityEntryPoint": "ui://engage-red-hat-support/app.html",
  "sequence": [
    {
      "step": 1,
      "name": "select_product",
      "type": "ui_gate",
      "allowedValues": ["linux"],
      "requiredInputs": ["product"],
      "produces": ["selected_product"],
      "stopOnFailure": true
    },
    {
      "step": 2,
      "name": "generate_and_fetch_diagnostics",
      "type": "tool_sequence",
      "requiredCalls": ["generate_sosreport", "fetch_sosreport"],
      "requiredInputs": [],
      "produces": ["fetch_reference", "artifact_ref"],
      "stopOnFailure": true
    },
    {
      "step": 3,
      "name": "connect_verify_and_attach",
      "type": "tool_or_http_sequence",
      "requiredOperations": [
        "POST /api/jira/connections",
        "jira_connection_status(connection_id) or GET /api/jira/connections/{connection_id}",
        "jira_list_attachments(connection_id, issue_key)",
        "jira_attach_artifact(connection_id, issue_key, artifact_ref)"
      ],
      "requiredInputs": ["artifact_ref", "issue_key", "connection_id"],
      "requiredPreconditions": ["issue_access_verified=true"],
      "stopOnFailure": true
    }
  ],
  "stateHandoff": {
    "requiredFields": [
      "selected_product",
      "fetch_reference",
      "artifact_ref",
      "connection_id",
      "issue_key",
      "issue_access_verified"
    ],
    "failClosed": true
  },
  "securityBoundary": {
    "secretInputsAllowedInMcpTools": false,
    "secretOutputsAllowedInMcpTools": false,
    "secretInputsAllowedOnlyAt": [
      "POST /api/jira/connections"
    ],
    "opaqueReference": "connection_id",
    "forbiddenFields": [
      "pat",
      "token",
      "access_token",
      "authorization",
      "auth_header",
      "secret"
    ]
  },
  "fallbackRequirements": {
    "nonUiHostBehavior": "Text-only instructions must provide equivalent sequence, required inputs, and retry guidance.",
    "toolResponseTextRequired": true
  },
  "compatibilityRequirements": {
    "preserveExistingToolNamesAndSchemas": true,
    "preserveExistingResources": true,
    "preserveExistingRegressionTests": true
  },
  "failureHandling": {
    "strategy": "stop_on_failed_step",
    "retryGuidanceRequired": true,
    "stepSpecificErrorMessaging": true
  }
}
